<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>班车路线信息</title>
  <style>
    html,
    body,
    #map {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }

         /* .demo-title {
              position: absolute;
              top: 25px;
              left: 25px;
              z-index: 1;
          }

          h1 {
              font-size: 18px;
              margin: 0;
              color: rgb(180, 180, 190);
          }

          h3 {
              font-size: 12px;
              font-weight: normal;
              margin-top: 5px;
              color: rgb(150,150,150);
          }*/
        </style>
      </head>

      <body>
        <!-- <div class="demo-title"> -->
          <!-- <h3>二厂班车路线信息</h3> -->
        </div>
        <div id="map"></div>
        <script src="https://webapi.amap.com/maps?v=2.0&key=92aa706e7e5b78f483a2e02df87450cd&plugin=AMap.Scale,AMap.ToolBar"></script>
        <script src="https://webapi.amap.com/loca?v=2.0.0&key=92aa706e7e5b78f483a2e02df87450cd"></script>
        <script src="route.js"></script>
        <script src="station.js"></script>
        <script>
          var map = new AMap.Map('map', {
            zoom: 12,
            center: [120.677983,31.218496],
            // showLabel: false,
            viewMode: '3D',
            mapStyle: 'amap://styles/blue',
            rotateEnable: false,
            pitchEnable: false,
            pitch: 40,
          });

          var loca = new Loca.Container({
            map,
          });
          window._loca = loca;

          var geo = new Loca.GeoJSONSource({
            data: json_data,
          });

          var layer = new Loca.PulseLineLayer({
                // loca,
                zIndex: 10,
                opacity: 1,
                visible: true,
                zooms: [2, 22],
              });

          var headColors = ['#EFBB51', '#7F3CFF', '#4CC19B', '#E06AC4', '#F15C1A', '#7A0FA6', '#6699CC', '#990000', '#996600','#CC0099', '#CCCCCC', '#33FFFF', '#FF99CC', '#FFFF33', '#666699', '#6699CC', '#99CCCC','#CC6666', '#999999', '#FF99FF', '#FFFFCC','#99FFFF', '#6699CC', '#FFFFFF'];

          layer.setSource(geo);
          layer.setStyle({
            altitude: 0,
            lineWidth: 4,
                // 脉冲头颜色
                headColor: (_, feature) => {
                  return headColors[feature.properties.type - 1];
                },
                // 脉冲尾颜色
                trailColor: 'rgba(128, 128, 128, 0.5)',
                // 脉冲长度，0.25 表示一段脉冲占整条路的 1/4
                interval: 1,
                // 脉冲线的速度，几秒钟跑完整段路
                duration: 5000,
              });
          loca.add(layer);
          loca.animate.start();

            for (var i=0; i<capitals.length; i+=1) {
              for(var j=0;j<capitals[i].length;j+=1){
                var time = capitals[i][j].time;
                var name = capitals[i][j].name;
                var center = capitals[i][j].center;
                var circleMarker = new AMap.CircleMarker({
                  center:center,
                  radius:3,
                  extData: capitals[i][j],
                  strokeColor:headColors[i],
                  // zIndex:10,
                  // bubble:true,
                })
                circleMarker.setMap(map);
                circleMarker.on('click', function(e){
                  openInfo(e.target._opts);
                });
              }
            }


            // 图例
            var lengend = new Loca.Legend({
              loca: loca,
              title: {
                label: '班车路线',
                fontColor: 'rgba(255,255,255,0.4)',
                fontSize: '12px'
              },
              style: {
                backgroundColor: 'rgba(255,255,255,0.1)',
                left: '10px',
                bottom: '20px',
                fontSize: '12px'
              },
              dataMap: [
              { label: '1号线', color: headColors[0] },
              { label: '2号线', color: headColors[1] },
              { label: '3号线', color: headColors[2] },
              { label: '4号线', color: headColors[3] },
              { label: '5号线', color: headColors[4] },
              { label: '6号线', color: headColors[5] },
              { label: '7号线', color: headColors[6] },
              { label: '8号线', color: headColors[7] },
              { label: '9号线', color: headColors[8] },
              { label: '10号线', color: headColors[9] },
              { label: '11号线', color: headColors[10] },
              { label: '12号线', color: headColors[11] },
              { label: '13号线', color: headColors[12] },
              { label: '14号线', color: headColors[13] },
              { label: '15号线', color: headColors[14] },
              { label: '16号线', color: headColors[15] },
              { label: '17号线', color: headColors[16] },
              { label: '18号线', color: headColors[17] },
              { label: '尹山湖A', color: headColors[18] },
              { label: '尹山湖B', color: headColors[19] },
              { label: '21号线', color: headColors[20] },
              { label: '22号线', color: headColors[21] },
              { label: '23号线', color: headColors[22] },
              { label: '24号线', color: headColors[23] }
              ],
            });

            var infoWindow;
            function openInfo(opts) {
              var info = [];
              info.push("<div><div><img style=\"float:left;\" src=\" bosch.png \"/></div> ");
              info.push("<div style=\"padding:0px 0px 0px 4px;\"><b>时间: " + opts.extData.time + "</b>");
              info.push("地址: "+ opts.extData.name);
              infoWindow = new AMap.InfoWindow({
                content: info.join("<br>")
              });
              infoWindow.open(map, opts.center);
            }

          </script>
        </body>
        </html>
