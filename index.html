<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>二厂班车路线信息(常白班)</title>
        <style>
          html,
          body,
          #map {
              width: 100%;
              height: 100%;
              margin: 0;
              padding: 0;
          }
        
          .demo-title {
              position: absolute;
              top: 25px;
              left: 25px;
              z-index: 1;
          }

          h1 {
              font-size: 18px;
              margin: 0;
              color: rgb(180, 180, 190);
          }

          h3 {
              font-size: 12px;
              font-weight: normal;
              margin-top: 5px;
              color: rgb(150,150,150);
          }
      </style>
    </head>

    <body>
      <div class="demo-title">
        <!-- <h3>二厂班车路线信息</h3> -->
    </div>
        <div id="map"></div>
        <script src="https://webapi.amap.com/maps?v=2.0&key=92aa706e7e5b78f483a2e02df87450cd&plugin=AMap.Scale,AMap.ToolBar"></script>
        <script src="https://webapi.amap.com/loca?v=2.0.0&key=92aa706e7e5b78f483a2e02df87450cd"></script>
        <script>
            var map = new AMap.Map('map', {
                zoom: 12,
                center: [120.794655,31.335666],
                showLabel: false,
                viewMode: '3D',
                mapStyle: 'amap://styles/blue',
                rotateEnable: false,
                pitchEnable: false,
                pitch: 40,
            });

            var loca = new Loca.Container({
                map,
            });
            window._loca = loca;

//数据

            var json_data = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "type": 1,
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
         [120.574951,31.309978],//1
          [120.574688,31.310835],
          [120.574474,31.313516],
          [120.574645,31.314666],
          [120.574592,31.315514],
          [120.577043,31.31567],
          [120.58004,31.315825],//2
          [120.587601,31.316402],//3
          [120.588877,31.316523],
          [120.588882,31.316701],
          [120.588721,31.317361],
          [120.588636,31.318195],
          [120.588324,31.318053],
          [120.588083,31.318017],
          [120.587128,31.318841],
          [120.586635,31.31941],
          [120.58554,31.321206],
          [120.585143,31.321674],
          [120.585143,31.321674],
          [120.586275,31.321793],
          [120.58715,31.321779],
          [120.587949,31.321669],
          [120.58841,31.32171],
          [120.588716,31.322297],
          [120.588888,31.322961],
          [120.588904,31.323406],
          [120.588818,31.324235],
          [120.589832,31.324299],
          [120.591087,31.324533],
          [120.591087,31.324533],
          [120.592047,31.324785],
          [120.592198,31.324881],
          [120.598705,31.326215],
          [120.602991,31.327099],
          [120.604332,31.327255],
          [120.604332,31.327255],
          [120.609632,31.327237],
          [120.610319,31.327296],
          [120.613548,31.327869],
          [120.614825,31.328094],
          [120.615774,31.328318],
          [120.616343,31.328547],
          [120.616911,31.328854],
          [120.616911,31.328854],
          [120.618607,31.330032],
          [120.618945,31.330146],
          [120.625983,31.331567],
          [120.632935,31.332855],
          [120.633734,31.332928],
          [120.637446,31.333056],
          [120.640349,31.333166],
          [120.646078,31.333519],
          [120.647655,31.333578],
          [120.648604,31.333666],
          [120.650144,31.333803],
          [120.650825,31.333735],
          [120.651421,31.33357],
          [120.652199,31.333176],
          [120.654272,31.331189],
          [120.654916,31.330584],
          [120.655686,31.329977],
          [120.65575,31.329858],
          [120.656555,31.329322],
          [120.658207,31.328429],
          [120.658722,31.327792],
          [120.658824,31.327535],
          [120.660492,31.319855],
          [120.66375,31.320356],//4
          [120.668609,31.321111],//5
          [120.674036,31.321968],//6
          [120.675593,31.322208],
          [120.675794,31.322183],
          [120.679231,31.322698],//7
          [120.683929,31.323528],
          [120.686665,31.324243],
          [120.689291,31.32477],
          [120.69083,31.32499],
          [120.69318,31.325169],
          [120.697413,31.325146],
          [120.700341,31.325332],
          [120.700209,31.329249],
          [120.699723,31.330844],//8
          [120.699303,31.332278],
          [120.699295,31.33228],
[120.704493,31.3331],
[120.705668,31.33332],
[120.706687,31.333526],
[120.709616,31.334177],
[120.71211,31.334644],
[120.714149,31.335011],
[120.719395,31.33589],
[120.723977,31.336633],
[120.726315,31.337027],
[120.732458,31.338053],
[120.737785,31.338933],
[120.738058,31.339029],
[120.74382,31.339982],
[120.747848,31.3406],
[120.750611,31.340967],
[120.760573,31.342488],
[120.762332,31.342772],
          [120.76569,31.343276],
          [120.77975,31.345791],
          [120.78346,31.346427],
          [120.78523,31.339848],
          [120.785627,31.338863],
          [120.786346,31.337419],
          [120.787279,31.336036],
          [120.788143,31.334991],
          [120.788341,31.334592],
          [120.788588,31.333236],
          [120.788947,31.333282]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "type": 2
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [120.613471,31.342429],//1
          [120.611527,31.352352],
          [120.621907,31.353007],
          [120.621907,31.353007],
          [120.631732,31.354459],//2
          [120.635179,31.355014],
          [120.635248,31.355087],
          [120.6344,31.359218],//3
          [120.639207,31.359888],
          [120.639984,31.357254],//4
          [120.639207,31.359888],
          [120.640672,31.354478],
          [120.640715,31.353571],
          [120.640339,31.35172],
          [120.639009,31.349457],
          [120.638108,31.347835],
          [120.637732,31.346754],
          [120.637415,31.344372],
          [120.638312,31.340175],
          [120.638971,31.337751],
          [120.639781,31.334576],
          [120.639905,31.334296],
          [120.640318,31.333613],
          [120.641122,31.333091],
          [120.642088,31.332944],
          [120.642694,31.333059],
          [120.643681,31.333251],
          [120.645806,31.333412],
          [120.646074,31.333517],
          [120.650038,31.333801],
          [120.651122,31.333655],
          [120.652077,31.333261],
          [120.654909,31.330598],
          [120.655817,31.329883],
          [120.656321,31.329594],
          [120.657119,31.329233],
          [120.657977,31.328958],
          [120.659565,31.328756],
          [120.660971,31.328912],
          [120.663777,31.329416],
[120.665799,31.329865],
[120.680562,31.332825],
[120.688169,31.334543],
[120.689741,31.334864],
[120.703275,31.337384],
[120.707964,31.338401],
[120.716434,31.340293],
[120.717791,31.340628],
[120.720779,31.341503],
[120.723,31.342218],
[120.725312,31.342891],
[120.727034,31.343313],
[120.729813,31.343936],
[120.735607,31.345113],
[120.745885,31.347404],
[120.747966,31.347835],
[120.749447,31.348082],
[120.753535,31.348545],
[120.757236,31.34893],
[120.760396,31.349241],
[120.760449,31.349168],
[120.760675,31.349154],
[120.762096,31.349237],
[120.762756,31.349356],
[120.763174,31.349379],
[120.763453,31.349324],
[120.763727,31.349214],
[120.763979,31.349053],
[120.764226,31.348504],
[120.764296,31.348192],
[120.764709,31.346199],
[120.764864,31.345773],
[120.76525,31.343794],
        [120.765401,31.34323],
        [120.76569,31.343276],
        [120.77975,31.345791],
          [120.78346,31.346427],
          [120.78523,31.339848],
          [120.785627,31.338863],
          [120.786346,31.337419],
          [120.787279,31.336036],
          [120.788143,31.334991],
          [120.788341,31.334592],
          [120.788588,31.333236],
          [120.788947,31.333282]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "type": 3
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
[120.652469,31.318601],
[120.656514,31.31922],
[120.681517,31.323165],
[120.681769,31.323152],
[120.683920,31.3235228],
[120.686736,31.3242606],
[120.687788,31.3244989],
[120.6887216,31.3246776],
[120.6902558,31.3249251],
[120.6911624,31.3250259],
[120.6925947,31.3251496],
[120.6931901,31.3251817],
[120.6941718,31.3252046],
[120.6952233,31.3252001],
[120.6969613,31.3251451],
[120.6983453,31.3251542],
[120.6992305,31.3252137],
[120.7003516,31.3253329],
[120.700282,31.328641],
[120.700212,31.329237],
[120.70496,31.329741],
[120.712459,31.330502],
[120.712502,31.328073],
[120.713242,31.328027],
[120.713661,31.327968],
[120.714262,31.327835],
[120.7152,31.327592],
[120.71578,31.327468],
[120.716397,31.327381],
[120.717266,31.327313],
[120.718172,31.327313],
[120.718693,31.327349],
[120.719594,31.327441],
[120.720023,31.327542],
[120.720238,31.325402],
[120.732967,31.325979],
[120.748165,31.327757],
[120.748079,31.331707],
[120.755804,31.332642],
[120.755932,31.328637],
[120.788881,31.332174],
[120.788693,31.33326],
[120.788945,31.333279],
        ]}},

        {
      "type": "Feature",
      "properties": {
        "type": 4
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [120.647453,31.321296],
[120.646139,31.325919],
[120.645828,31.326639],
[120.645393,31.327413],
[120.644637,31.32844],
[120.643736,31.329425],
[120.643076,31.329622],
[120.642378,31.330144],
[120.641837,31.330772],
[120.640576,31.332687],
[120.640581,31.332839],
[120.640699,31.332981],
[120.640882,31.333104],
[120.642008,31.333178],
[120.643446,31.333306],
[120.643666,31.333347],
[120.644444,31.333407],
[120.644733,31.333389],
[120.646471,31.333485],
[120.648381,31.333563],
[120.649765,31.333737],
[120.650479,31.333741],
[120.650994,31.33365],
[120.651616,31.333453],
[120.652372,31.332999],
[120.653536,31.331913],
[120.654625,31.330708],
[120.655022,31.330319],
[120.655661,31.329833],
[120.65646,31.32937],
[120.657286,31.32904],
[120.657984,31.328871],
[120.658858,31.328761],
[120.659115,31.328701],
[120.660628,31.328728],
[120.66235,31.329045],
[120.66352,31.32931],
[120.663777,31.329416],
[120.665799,31.329865],
[120.680562,31.332825],
[120.688169,31.334543],
[120.689741,31.334864],
[120.703275,31.337384],
[120.707964,31.338401],
[120.716434,31.340293],
[120.717791,31.340628],
[120.720779,31.341503],
[120.723,31.342218],
[120.725312,31.342891],
[120.727034,31.343313],
[120.729813,31.343936],
[120.735607,31.345113],
[120.745885,31.347404],
[120.747966,31.347835],
[120.749447,31.348082],
[120.753535,31.348545],
[120.757236,31.34893],
[120.760396,31.349241],
[120.760449,31.349168],
[120.760675,31.349154],
[120.762096,31.349237],
[120.762756,31.349356],
[120.763174,31.349379],
[120.763453,31.349324],
[120.763727,31.349214],
[120.763979,31.349053],
[120.764226,31.348504],
[120.764296,31.348192],
[120.764709,31.346199],
[120.764864,31.345773],
[120.76525,31.343794],
        [120.765401,31.34323],
        [120.76569,31.343276],
        [120.77975,31.345791],
          [120.78346,31.346427],
          [120.78523,31.339848],
          [120.785627,31.338863],
          [120.786346,31.337419],
          [120.787279,31.336036],
          [120.788143,31.334991],
          [120.788341,31.334592],
          [120.788588,31.333236],
          [120.788947,31.333282]
        ]}},

        {
      "type": "Feature",
      "properties": {
        "type": 5
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
        [120.603598,31.272248],
[120.603581,31.271225],
[120.603656,31.270195],
[120.60371,31.268751],
[120.602573,31.268627],
[120.60224,31.26859],
[120.602004,31.268554],
[120.601704,31.268476],
[120.60143,31.268384],
[120.60114,31.268251],
[120.600727,31.268027],
[120.600416,31.267834],
[120.600116,31.267706],
[120.599837,31.267628],
[120.599424,31.267577],
[120.598083,31.267706],
[120.5973,31.267728],
[120.596597,31.267719],
[120.596366,31.267696],
[120.596452,31.267366],
[120.596827,31.266605],
[120.597171,31.266027],
[120.597605,31.264739],
[120.597589,31.264615],
[120.602567,31.265165],
[120.603072,31.265207],
[120.612545,31.266367],
[120.613157,31.266468],
[120.613715,31.26655],
[120.614541,31.266633],
[120.615184,31.266642],
[120.615683,31.266619],
[120.617995,31.266646],
[120.617829,31.267559],
[120.617121,31.272337],
[120.619503,31.272323],
[120.620232,31.272286],
[120.620876,31.272176],
[120.621815,31.272057],
[120.62263,31.272038],
[120.625119,31.272254],
[120.625457,31.272272],
[120.625988,31.272281],
[120.626809,31.272254],
[120.626938,31.272194],
[120.627791,31.272144],
[120.627936,31.270617],
[120.628172,31.268838],
[120.628445,31.267077],
[120.629862,31.267174],
[120.630559,31.267219],
[120.632501,31.267325],
[120.63308,31.267371],
[120.635741,31.267545],
[120.637382,31.267632],
[120.639485,31.267605],
[120.63882,31.272497],
[120.645188,31.272937],
[120.645461,31.272969],
[120.645767,31.273052],
[120.646421,31.273304],
[120.646668,31.273373],
[120.647033,31.273455],
[120.64935,31.273762],
[120.649442,31.273717],
[120.65096,31.27395],
[120.651185,31.273964],
[120.65148,31.27396],
[120.652242,31.273909],
[120.652515,31.273969],
[120.652709,31.274093],
[120.652773,31.274175],
[120.652848,31.274267],
[120.652891,31.274409],
[120.65288,31.274629],
[120.652778,31.27484],
[120.652537,31.27528],
[120.652376,31.275904],
[120.65251,31.276834],
[120.652859,31.278627],
[120.652939,31.278641],
[120.653004,31.278705],
[120.653127,31.279365],
[120.653283,31.279824],
[120.65339,31.280025],
[120.653503,31.2802],
[120.653873,31.280617],
[120.654168,31.281002],
[120.654538,31.281515],
[120.65487,31.281827],
[120.655251,31.282098],
[120.655691,31.28229],
[120.656651,31.282487],
[120.656791,31.282533],
[120.657343,31.282602],
[120.657413,31.282661],
[120.677578,31.284587],
[120.686193,31.285339],
[120.68717,31.285375],
[120.688918,31.285348],
[120.691043,31.28522],
[120.69218,31.285073],
[120.693929,31.284724],
[120.695227,31.284394],
[120.697362,31.283698],
[120.707436,31.280112],
[120.708938,31.279681],
[120.710516,31.279351],
[120.712447,31.279095],
[120.71441,31.279003],
[120.725091,31.27937],
[120.732182,31.279581],
[120.732349,31.279544],
[120.734285,31.279659],
[120.765233,31.280759],
[120.765458,31.280676],
[120.767282,31.280667],
[120.768473,31.280475],
[120.769009,31.280456],
[120.769556,31.280585],
[120.770061,31.280851],
[120.770522,31.281208],
[120.770865,31.281731],
[120.771026,31.282409],
[120.770533,31.284656],
[120.770377,31.297913],
[120.770458,31.297991],
[120.770474,31.298541],
[120.770447,31.300901],
[120.770388,31.301007],
[120.7702,31.314821],
[120.770243,31.314986],
[120.770281,31.315577],
[120.770281,31.31599],
[120.78985,31.317539],
[120.789276,31.326099],
[120.789651,31.326122],
        ]}},

]};

            var geo = new Loca.GeoJSONSource({
                data: json_data,
            });

            var layer = new Loca.PulseLineLayer({
                // loca,
                zIndex: 10,
                opacity: 1,
                visible: true,
                zooms: [2, 22],
            });

            var headColors = ['#EFBB51', '#7F3CFF', '#4CC19B', '#E06AC4', '#F15C1A', '#7A0FA6', '#006600', '#6699CC', '#990000', '#996600','#CC0099', '#CC6600', '#CCFFCC', '#33FFFF', '#FF99CC', '#FFFF33', '#336699', '#6699CC', '#99CCCC','#CC6666', '#999999', '#FF99FF', '#FFFFCC','#99FFFF', '#6699CC', '#FFFFFF'];

            layer.setSource(geo);
            layer.setStyle({
                altitude: 0,
                lineWidth: 4,
                // 脉冲头颜色
                headColor: (_, feature) => {
                    return headColors[feature.properties.type - 1];
                },
                // 脉冲尾颜色
                trailColor: 'rgba(128, 128, 128, 0.5)',
                // 脉冲长度，0.25 表示一段脉冲占整条路的 1/4
                interval: 0.5,
                // 脉冲线的速度，几秒钟跑完整段路
                duration: 5000,
            });
            loca.add(layer);
            loca.animate.start();

            //站点
            var capitals = [
[
        {
    "time":"7:14",
    "name":"来凤桥公交站（西环路东）",
    "center":[120.574951,31.309978]
},{
    "time":"7:18",
    "name":"西园路中公交站",
    "center":[120.58004,31.315825]
},{
    "time":"7:20",
    "name":"西园路东公交站",
    "center":[120.587601,31.316402]
},{
    "time":"7:45",
    "name":"新城花园公交站",
    "center":[120.66375,31.320356]
},{
    "time":"7:46",
    "name":"新城邻里中心",
    "center":[120.668609,31.321111]
},{
    "time":"7:50",
    "name":"新加花园西公交站",
    "center":[120.674036,31.321968]
},{
    "time":"7:53",
    "name":"沁苑小区公交站",
    "center":[120.679231,31.322698]
},{
    "time":"8:00",
    "name":"玲珑街与槟榔路交界北",
    "center":[120.699723,31.330844]
}],

[{
    "time":"7:30",
    "name":"万达广场公交站",
    "center":[120.613471,31.342429]
},{
    "time":"7:40",
    "name":"晨曦印象花园",
    "center":[120.631732,31.354459]
},{
    "time":"7:42",
    "name":"澄和路和古元路交叉口(晨曦馨苑)",
    "center":[120.6344,31.359218]
},{
    "time":"7:45",
    "name":"苏州国际外国语学校公交站",
    "center":[120.639984,31.357254]
}],

[{
    "time":"7:31",
    "name":"东港新村",
    "center":[120.652469,31.318601]
},{
    "time":"7:34",
    "name":"印象城北公交站",
    "center":[120.658599,31.319553]
},{
    "time":"7:50",
    "name":"雅戈尔未来城(沈浒路口)",
    "center":[120.70932,31.330171]
},{
    "time":"7:52",
    "name":"星湖花园东",
    "center":[120.718676,31.327357]
},{
    "time":"7:54",
    "name":"景城学校公交站",
    "center":[120.720081,31.326798]
},{
    "time":"8:04",
    "name":"东沙湖琉璃街公交站",
    "center":[120.748669,31.331775]
}],

[{
    "time":"7:42",
    "name":"东港新村公交站",
    "center":[120.647456,31.3213]
},{
    "time":"7:45",
    "name":"苏安新村公交站",
    "center":[120.644638,31.328424]
},{
    "time":"7:47",
    "name":"坝基桥北环高架",
    "center":[120.641618,31.331086]
}],

[{
    "time":"7:05",
    "name":"友联二村",
    "center":[120.603598,31.272248]
},{
    "time":"7:10",
    "name":"世茂和苑",
    "center":[120.597056,31.266226]
},{
    "time":"7:13",
    "name":"四季晶华公交站",
    "center":[120.606907,31.265675]
},{
    "time":"7:17",
    "name":"宝带西路与龙西路口",
    "center":[120.617998,31.266637]
},{
    "time":"7:19",
    "name":"吴中西路与龙西路口",
    "center":[120.617123,31.272341]
},{
    "time":"7:24",
    "name":"东吴北路中国银行对面",
    "center":[120.627842,31.271514]
},{
    "time":"7:35",
    "name":"迎春路宝带东路北公交站",
    "center":[120.639236,31.269301]
},{
    "time":"7:37",
    "name":"吴中东路瑞华迎春医院对面",
    "center":[120.639339,31.272536]
}],

];

            for (var i=0; i<capitals.length; i+=1) {
                for(var j=0;j<capitals[i].length;j+=1){
                    var time = capitals[i][j].time;
                    var name = capitals[i][j].name;
                    var center = capitals[i][j].center;
                    var circleMarker = new AMap.CircleMarker({
                        center:center,
                        radius:3,
                        extData: capitals[i][j],
                        strokeColor:headColors[i],
                        zIndex:10,
                        bubble:true,
                    })
                    circleMarker.setMap(map);
                    circleMarker.on('click', function(e){
                        openInfo(e.target._opts);
                    });
                }
            }


            // 图例
            var lengend = new Loca.Legend({
                loca: loca,
                title: {
                    label: '班车路线',
                    fontColor: 'rgba(255,255,255,0.4)',
                    fontSize: '16px'
                },
                style: {
                    backgroundColor: 'rgba(255,255,255,0.1)',
                    left: '20px',
                    bottom: '40px',
                    fontSize: '12px'
                },
                dataMap: [
                    { label: '1号线', color: headColors[0] },
                    { label: '2号线', color: headColors[1] },
                    { label: '3号线', color: headColors[2] },
                    { label: '4号线', color: headColors[3] },
                    { label: '5号线', color: headColors[4] },
                    { label: '6号线', color: headColors[5] },
                    { label: '7号线', color: headColors[6] },
                    { label: '8号线', color: headColors[7] },
                    { label: '9号线', color: headColors[8] },
                    { label: '10号线', color: headColors[9] },
                    { label: '11号线', color: headColors[10] },
                    { label: '12号线', color: headColors[11] },
                    { label: '13号线', color: headColors[12] },
                    { label: '14号线', color: headColors[13] },
                    { label: '15号线', color: headColors[14] },
                    { label: '16号线', color: headColors[15] },
                    { label: '17号线', color: headColors[16] },
                    { label: '18号线', color: headColors[17] },
                    { label: '19号线', color: headColors[18] },
                    { label: '20号线', color: headColors[19] },
                    { label: '21号线', color: headColors[20] },
                    { label: '22号线', color: headColors[21] },
                    { label: '23号线', color: headColors[22] },
                    { label: '24号线', color: headColors[23] },
                    { label: '25号线', color: headColors[24] },
                    { label: '上海线', color: headColors[25] }
                ],
            });

            var infoWindow;
            function openInfo(opts) {
            var info = [];
            info.push("<div><div><img style=\"float:left;\" src=\" bosch.png \"/></div> ");
                info.push("<div style=\"padding:0px 0px 0px 4px;\"><b>时间: " + opts.extData.time + "</b>");
                info.push("地址: "+ opts.extData.name);
                infoWindow = new AMap.InfoWindow({
                content: info.join("<br>")
            });
            infoWindow.open(map, opts.center);
            }

        </script>
    </body>
</html>
